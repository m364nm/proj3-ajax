<!DOCTYPE HTML PUBLIC "-//IETF//DTD HTML//EN">
<html>
<head>
<title>ACP Controle Times</title>

<!-- 'viewport' is used by bootstrap to respond to device size -->
<meta name="viewport" content="width=device-width, initial-scale=1">

<!-- Javascript:  JQuery from a content distribution network (CDN) -->
<script
   src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js">
</script>

<!-- Bootstrap includes javascript and css  (must follow jquery) -->
<link rel="stylesheet"
 href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css">
 <script
  src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/js/bootstrap.min.js">
</script>

<!-- <script type="text/javascript"  -->
<!--    src="/static/js/calc.js"> -->
<!-- </script> -->
</head>

<!-- Our own style sheet -->
<link rel="stylesheet" href="/static/css/calc.css" />

<body>
<!-- bootstrap requires a 'container' div around content -->
<div class="container">

<h1>ACP Brevet Closing times</h1>

  <!--
   If there are any warnings or other messages from a prior
   request to the server,
   they appear above the rest of the content, just until the next
   action.  (This is only on request/response transactions that
   result in regenerating the page, not on every xmlhttp request.)
  -->

{% with messages = get_flashed_messages() %}
  {% if messages %}
    <ul class=flashes>
    {% for message in messages %}
      <li>{{ message }}</li>
    {% endfor %}
    </ul>
  {% endif %}
{% endwith %}

<!-- Design on bootstrap grid -->
<form role="form">

  <!-- Brevet Distance, start date, start time -->
  <div class="settings">

    <div class="row">
      <div class="col-md-2 col-md-offset-4">
        <h6>Brevet Length</h6>
      </div>
      <div class="col-md-2 ">
        <h6>Distance units</h6>
      </div>
    </div>

    <div class="row">
      <div class="col-md-2 col-md-offset-4">
         <!-- Drop-down list -->
         <select name="brevet" id="brevet_unit">
           <option value="200"> 200 </option>
           <option value="300"> 300 </option>
           <option value="400"> 400 </option>
           <option value="600"> 600 </option>
           <option value="1000"> 1000 </option>
         </select>
         <label for="brevet_unit"> km </label>
       </div>

       <div class="col-md-1">
         <label class="radio-inline"><input type="radio" class="form-control" id="mi" name="unit" value="mi"/> miles </label>
       </div>
       <div class="col-md-1">
         <label class="radio-inline"><input type="radio" class="form-control" id="km" name="unit" value="km"/> km </label>
       </div>
    </div>
    <div class="row">
      <div class="col-md-3 col-md-offset-3">
        <!-- Need label here, see if I can get a calendar object -->
        <input type="date" class="form-control"
         name="starting-date" value="mm/dd/yyyy"/>
      </div>

      <div class="col-md-3">
        <!-- Need label here, see if I can get a time object -->
        <input type="time" class="form-control"
         name="starting-time" value="hh:mm"/>
      </div>
    </div>
  </div> <!-- end settings div-->
</form>
<form role="form" id="timesform">
  <div class"inputs">
    <div class="row">
      <h5> Enter the distance of each checkpoint. The location field is optional. </h5>
    </div>
    <!-- Form elements -->
    <div class="row">
      <div class="col-md-3">
        <input type="text" class="form-control" id="distanceinput"
         name="dist" value="Distance"/>
      </div>
      <div class="col-md-3">
        <input type="text" class="form-control"
          name="location" value="location" />
      </div>
      <div class="col-md-6">
        <span class="times form-control">(times)</span>
      </div>
    </div>

  </div>
</form>

<script type="text/javascript">

  $SCRIPT_ROOT = {{ request.script_root|tojson|safe }};

    $(document).ready(function(){
    // Do the following when the page is finished loading
      console.log("document ready and listening")
      $('.settings').change(
        function() {
            console.log("settings has changed");
        });

      // When a field named 'brevet' is changed ...
      $('select[name="brevet"]').change(
        // ... execute this function
        function(){
          console.log("brevet distance changed");
          //if this.val() returns string use parseInt($(this).val());
          var brevet_dist = $(this).val();

          // AJAX request
          $.getJSON($SCRIPT_ROOT + '/_set_brevet',
            // The object to pass to the server
            { brevet: brevet_dist },
            // The function to call with the response
            function(data) {
              var b_dist = data.result;
              //alert("Got a response: " +  b_dist);
              //target.text(times);
          }); // End of the call to getJSON

      });  // End of the function to be called when brevet field changes


      // When a field named 'starting-date' is changed ...
      $('input[name="starting-date"]').change(
        // ... execute this function
        function(){
          console.log("starting-date changed");
          //if this.val() returns string use parseInt($(this).val());
          var start_date = $(this).val();

          // AJAX request
          $.getJSON($SCRIPT_ROOT + '/_set_sdate',
            // The object to pass to the server
            { sdate: start_date},
            // The function to call with the response
            function(data) {
              var s_date = data.result;
              //alert("Got a response: " +  s_date);
              //target.text(times);
          }); // End of the call to getJSON

      });  // End of the function to be called when brevet field changes

      // When a field named 'starting-time' is changed ...
      $('input[name="starting-time"]').change(
        // ... execute this function
        function(){
          console.log("starting-time changed");
          //if this.val() returns string use parseInt($(this).val());
          var start_time = $(this).val();

          // AJAX request
          $.getJSON($SCRIPT_ROOT + '/_set_stime',
            // The object to pass to the server
            { stime: start_time},
            // The function to call with the response
            function(data) {
              var s_time = data.result;
              //alert("Got a response: " +  s_time);
              //target.text(times);
          }); // End of the call to getJSON

      });  // End of the function to be called when brevet field changes

      // When a field named 'starting-time' is changed ...
      $('input[name="unit"]').change(
        // ... execute this function
        function(){
          console.log("unit changed");
          //if this.val() returns string use parseInt($(this).val());
          var input_unit = $(this).val();

          // AJAX request
          $.getJSON($SCRIPT_ROOT + '/_set_units',
            // The object to pass to the server
            { unit: input_unit},
            // The function to call with the response
            function(data) {
              var in_unit = data.result;
              //alert("Got a response: " +  in_unit);
              //target.text(times);
          }); // End of the call to getJSON

      });


      // When a field named 'dist' is changed ...
      $('input[name="dist"]').change(
        // ... execute this function
        function(){
          console.log("control distance changed");
          var control = $(this).val();

          var target = $(this).parents(".row").find(".times");

          // DEBUG: How do I replace the 'times' field?
          // alert("Content of the field I want to change: " +
          //   target.html());

          // AJAX request
          $.getJSON($SCRIPT_ROOT + '/_calc_times',
            // The object to pass to the server
            { dist: control },
            // The function to call with the response
            function(data) {
              var times = data.result;
              //alert("Got a response: " +  times);
              target.text(times);
          }); // End of the call to getJSON
      });  // End of the function to be called when field changes


  });   // end of what we do on document ready

</script>

</div>
</body>
</html>
